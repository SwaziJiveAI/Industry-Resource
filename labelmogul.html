<!DOCTYPE html>
<html>
<head>
  <title>eSwatini Music Mogul</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
    .game-container { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; }
    .main-panel { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .side-panel { display: flex; flex-direction: column; gap: 20px; }
    .info-box { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .decision-btn {
      margin: 5px; padding: 10px 15px;
      background: #4CAF50; color: white;
      border: none; border-radius: 4px;
      cursor: pointer;
    }
    .new-game-btn {
      margin: 10px; padding: 10px 15px;
      background: #FF5733; color: white;
      border: none; border-radius: 4px;
      cursor: pointer;
    }
    /* The log container holds game messages */
    #log-container {
      height: 150px; overflow-y: auto;
      padding: 10px; background: #1a1a1a;
      color: #00ff00; margin-bottom: 10px;
      border: 2px solid #333;
    }
    /* The scenario container shows the current decision prompt */
    #scenario-container {
      margin-bottom: 20px;
    }
    .status-bar {
      display: flex; justify-content: space-between;
      margin-bottom: 20px; padding: 10px;
      background: #333; color: white;
      border-radius: 4px;
    }
    .scroll-box { height: 300px; overflow-y: auto; padding: 10px; border: 1px solid #ddd; }
    .artist-card, .staff-card {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 5px;
    }
    .scenario-box { margin-bottom: 15px; }
    .marketplace-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 8px;
    }
    .marketplace-section {
      background: white;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .market-scroll {
      height: 150px;
      overflow-y: auto;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .market-item {
      padding: 8px;
      margin: 5px 0;
      background: #f8f8f8;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .market-item:hover {
      background: #e8e8e8;
    }
    .reputation-level-basic { background: #FFE5E5 !important; }
    .reputation-level-rising { background: #FFEDCC !important; }
    .reputation-level-notable { background: #E5FFE5 !important; }
    .reputation-level-celebrated { background: #E5F0FF !important; }
    .reputation-level-legendary { background: #F2E5FF !important; }
  </style>
</head>
<body>
  <div class="status-bar">
      <div>ğŸ’° Cash: <span id="cash">E150,000</span></div>
      <div>ğŸ“… Day: <span id="day">1</span>/50</div>
      <div>ğŸŒŸ Reputation: <span id="reputation-points">0</span> (<span id="reputation-level">Basic</span>)</div>
  </div>

  <div class="game-container">
      <div class="main-panel">
          <!-- Log messages go here -->
          <div id="log-container">
              <div class="scenario-box">
                  â–¶ï¸ Welcome to eSwatini Music Mogul!<br>
                  â–¶ï¸ Day 1: Start building your music empire!
              </div>
          </div>
          <!-- Current scenario prompt -->
          <div id="scenario-container"></div>
          <div class="marketplace-container">
              <div class="marketplace-section">
                  <h3>ğŸ­ Shows</h3>
                  <div id="shows-market" class="market-scroll"></div>
              </div>
              <div class="marketplace-section">
                  <h3>ğŸ“ Deals</h3>
                  <div id="deals-market" class="market-scroll"></div>
              </div>
              <div class="marketplace-section">
                  <h3>ğŸ¤ Artists Market</h3>
                  <div id="artists-market" class="market-scroll"></div>
              </div>
              <div class="marketplace-section">
                  <h3>ğŸ›ï¸ Equipment</h3>
                  <div id="equipment-market" class="market-scroll"></div>
              </div>
              <div class="marketplace-section">
                  <h3>ğŸ“š Training</h3>
                  <div id="training-market" class="market-scroll"></div>
              </div>
              <div class="marketplace-section">
                  <h3>ğŸ“£ Marketing</h3>
                  <div id="marketing-market" class="market-scroll"></div>
              </div>
          </div>
      </div>

      <div class="side-panel">
          <div class="info-box">
              <h3>ğŸ¤ Artists</h3>
              <div id="artist-roster" class="scroll-box"></div>
          </div>
          <div class="info-box">
              <h3>ğŸ“¦ Inventory</h3>
              <div id="inventory-list" class="scroll-box"></div>
          </div>
          <div class="info-box">
              <h3>ğŸ‘¥ Staff</h3>
              <div id="staff-list" class="scroll-box"></div>
          </div>
      </div>
  </div>

  <script>
    let gameState;

    const REPUTATION_LEVELS = {
      1: { name: "Basic", min: 0 },
      2: { name: "Rising", min: 500000 },
      3: { name: "Notable", min: 1000000 },
      4: { name: "Celebrated", min: 1500000 },
      5: { name: "Legendary", min: 2000000 }
    };

    const scenarios = [
      {
        question: "A social media influencer promotes your artist:",
        options: [
          {
            text: "Pay for the promotion (Cost E25k)",
            effect: () => {
              adjustArtistHappiness(5);
              adjustStaffMorale(0);
              adjustArtistPopularity(30);
              adjustReputation(10);
              return -25000;
            }
          },
          {
            text: "Stay independent (Safe E20k)",
            effect: () => {
              adjustArtistHappiness(5);
              adjustStaffMorale(5);
              adjustArtistPopularity(3);
              adjustReputation(5);
              return 20000;
            }
          },
          {
            text: "Do Nothing (Risk E10k)",
            effect: () => {
              adjustArtistHappiness(-10);
              adjustStaffMorale(-5);
              adjustArtistPopularity(-3);
              adjustReputation(-5);
              return -10000;
            }
          }
        ]
      },
      {
        question: "A rival label tries to poach your top artist:",
        options: [
          {
            text: "Counteroffer (Cost E80k)",
            effect: () => {
              adjustArtistHappiness(10);
              adjustStaffMorale(0);
              adjustArtistPopularity(10);
              adjustReputation(15);
              return -80000;
            }
          },
          {
            text: "Let them go (Gain E40k)",
            effect: () => {
              adjustArtistHappiness(-10);
              adjustStaffMorale(5);
              adjustArtistPopularity(-5);
              adjustReputation(-10);
              return 40000;
            }
          },
          {
            text: "Do Nothing (Risk Artist Leaving)",
            effect: () => {
              adjustArtistHappiness(-15);
              adjustStaffMorale(-10);
              adjustArtistPopularity(-20);
              adjustReputation(-20);
              return 0;
            }
          }
        ]
      }
    ];

    function initializeGameState() {
      gameState = {
        cash: 50000,
        day: 1,
        reputation: 0,
        scenarios: [],
        artists: [
          { name: "Lihlombe 12", genre: "sibhaca", popularity: 25, happiness: 80, contractDays: 15 },
          { name: "Mbabane Beats", genre: "hiphop", popularity: 40, happiness: 70, contractDays: 18 }
        ],
        staff: [{ role: "Manager", morale: 100 }, { role: "Publicist", morale: 85 }],
        activeDeals: [],
        equipment: []
      };
      updateReputationDisplay();
    }

    function adjustReputation(amount) {
      gameState.reputation = Math.max(0, Math.min(100, gameState.reputation + amount));
      updateReputationDisplay();
    }

    function getCurrentReputationLevel() {
      let level = 1;
      for (const [key, value] of Object.entries(REPUTATION_LEVELS)) {
        if (gameState.cash >= value.min) level = parseInt(key);
      }
      return level;
    }

    function updateReputationDisplay() {
      const level = getCurrentReputationLevel();
      const levelElement = document.getElementById('reputation-level');
      levelElement.textContent = REPUTATION_LEVELS[level].name;
      document.getElementById('reputation-points').textContent = Math.floor(gameState.cash / 500000 * 100);
      
      levelElement.classList.remove(
          'reputation-level-basic',
          'reputation-level-rising',
          'reputation-level-notable',
          'reputation-level-celebrated',
          'reputation-level-legendary'
      );
      
      levelElement.classList.add(`reputation-level-${REPUTATION_LEVELS[level].name.toLowerCase()}`);
    }

    // addMessage appends new messages to the log container
    function addMessage(message) {
      const container = document.getElementById('log-container');
      container.innerHTML += `<div>${message}</div>`;
      container.scrollTop = container.scrollHeight;
    }

    function updateGameDisplay() {
      document.getElementById('cash').textContent = `E${gameState.cash.toLocaleString()}`;
      document.getElementById('day').textContent = gameState.day;
      
      document.getElementById('artist-roster').innerHTML = gameState.artists.map(artist => `
        <div class="artist-card">
          <strong>${artist.name}</strong> (${artist.genre})<br>
          ğŸ“ˆ Popularity: ${artist.popularity}<br>
          ğŸ˜Š Happiness: ${artist.happiness}%<br>
          ğŸ“… Contract: ${artist.contractDays} days
        </div>
      `).join('');
      
      document.getElementById('staff-list').innerHTML = gameState.staff.map(staff => `
        <div class="staff-card">
          <strong>${staff.role}</strong><br>
          ğŸ˜Š Morale: ${staff.morale}%
        </div>
      `).join('');

      document.getElementById('inventory-list').innerHTML = [
        ...gameState.equipment.map(item => `
          <div class="market-item">
            <strong>ğŸ›ï¸ ${item.name}</strong><br>
            â­ Quality: +${item.quality}<br>
            ğŸ”§ Maintenance: E${item.maintenance}/day
          </div>
        `),
        ...gameState.activeDeals.map(deal => `
          <div class="market-item">
            <strong>ğŸ“ ${deal.name}</strong><br>
            ğŸ’° Revenue: E${deal.revenue}/day<br>
            â±ï¸ Days Left: ${deal.daysLeft}
          </div>
        `)
      ].join('');
    }

    function adjustArtistHappiness(amount) {
      gameState.artists.forEach(artist => {
        artist.happiness = Math.max(0, Math.min(100, artist.happiness + amount));
      });
    }

    function adjustStaffMorale(amount) {
      gameState.staff.forEach(staff => {
        staff.morale = Math.max(0, Math.min(100, staff.morale + amount));
      });
    }

    function adjustArtistPopularity(amount) {
      gameState.artists.forEach(artist => {
        artist.popularity = Math.max(0, artist.popularity + amount);
      });
    }

    const marketData = {
      shows: [
        { name: "Local Club Show", cost: 5000, popularity: 5, duration: 1 },
        { name: "Radio Station Performance", cost: 15000, popularity: 15, duration: 2 },
        { name: "Music Festival Slot", cost: 50000, popularity: 30, duration: 3 },
        { name: "National TV Show", cost: 75000, popularity: 40, duration: 4 },
        { name: "International Tour", cost: 100000, popularity: 50, duration: 5 },
        { name: "Charity Concert", cost: 20000, popularity: 20, duration: 2 },
        { name: "Private Event", cost: 30000, popularity: 25, duration: 3 }
      ],
      deals: [
        { name: "Merchandise Deal", cost: 20000, revenue: 5000, duration: 5 },
        { name: "Brand Sponsorship", cost: 50000, revenue: 15000, duration: 7 },
        { name: "Distribution Deal", cost: 100000, revenue: 25000, duration: 10 },
        { name: "Streaming Partnership", cost: 80000, revenue: 20000, duration: 8 },
        { name: "Endorsement Contract", cost: 60000, revenue: 18000, duration: 6 }
      ],
      artists: [
        { name: "Rising Star", genre: "Afropop", cost: 30000, popularity: 35, contractCost: 5000 },
        { name: "Underground Talent", genre: "Hip-hop", cost: 25000, popularity: 30, contractCost: 4000 },
        { name: "Traditional Artist", genre: "Sibhaca", cost: 40000, popularity: 45, contractCost: 6000 },
        { name: "Pop Sensation", genre: "Pop", cost: 50000, popularity: 50, contractCost: 7000 },
        { name: "Jazz Virtuoso", genre: "Jazz", cost: 35000, popularity: 40, contractCost: 5500 }
      ],
      equipment: [
        { name: "Studio Microphone", cost: 8000, quality: 10, maintenance: 500 },
        { name: "Mixing Console", cost: 25000, quality: 20, maintenance: 1000 },
        { name: "Recording Suite", cost: 60000, quality: 35, maintenance: 2000 },
        { name: "Live Sound System", cost: 40000, quality: 25, maintenance: 1500 },
        { name: "Lighting Rig", cost: 15000, quality: 15, maintenance: 700 }
      ],
      training: [
        { name: "Vocal Workshop", cost: 12000, skillBoost: 15, duration: 3 },
        { name: "Dance Training", cost: 18000, skillBoost: 20, duration: 5 },
        { name: "Production Course", cost: 30000, skillBoost: 25, duration: 7 },
        { name: "Songwriting Masterclass", cost: 25000, skillBoost: 22, duration: 6 },
        { name: "Stage Presence Seminar", cost: 20000, skillBoost: 18, duration: 4 }
      ],
      marketing: [
        { name: "Social Media Campaign", cost: 15000, exposure: 20, duration: 5 },
        { name: "Radio Advertisement", cost: 25000, exposure: 30, duration: 7 },
        { name: "TV Commercial", cost: 50000, exposure: 50, duration: 10 },
        { name: "Billboard Promotion", cost: 35000, exposure: 40, duration: 8 },
        { name: "Influencer Collaboration", cost: 20000, exposure: 25, duration: 6 }
      ]
    };

    function updateMarketplaces() {
      updateShowsMarket();
      updateDealsMarket();
      updateArtistsMarket();
      updateEquipmentMarket();
      updateTrainingMarket();
      updateMarketingMarket();
    }

    function updateEquipmentMarket() {
      document.getElementById('equipment-market').innerHTML = marketData.equipment.map(item => `
        <div class="market-item" onclick="buyEquipment('${item.name}', ${item.cost}, ${item.quality}, ${item.maintenance})">
          <strong>${item.name}</strong><br>
          ğŸ’° Cost: E${item.cost.toLocaleString()}<br>
          â­ Quality: +${item.quality}<br>
          ğŸ”§ Maintenance: E${item.maintenance}/day
        </div>
      `).join('');
    }

    function updateTrainingMarket() {
      document.getElementById('training-market').innerHTML = marketData.training.map(course => `
        <div class="market-item" onclick="bookTraining('${course.name}', ${course.cost}, ${course.skillBoost}, ${course.duration})">
          <strong>${course.name}</strong><br>
          ğŸ’° Cost: E${course.cost.toLocaleString()}<br>
          ğŸ“ˆ Skill Boost: +${course.skillBoost}<br>
          â±ï¸ Duration: ${course.duration} days
        </div>
      `).join('');
    }

    function updateMarketingMarket() {
      document.getElementById('marketing-market').innerHTML = marketData.marketing.map(campaign => `
        <div class="market-item" onclick="launchCampaign('${campaign.name}', ${campaign.cost}, ${campaign.exposure}, ${campaign.duration})">
          <strong>${campaign.name}</strong><br>
          ğŸ’° Cost: E${campaign.cost.toLocaleString()}<br>
          ğŸ¯ Exposure: +${campaign.exposure}<br>
          â±ï¸ Duration: ${campaign.duration} days
        </div>
      `).join('');
    }

    function checkBankruptcy() {
      if (gameState.cash < 0) {
        addMessage("ğŸ’¥ Game Over: You've gone bankrupt!");
        document.querySelectorAll('.market-item').forEach(item => item.onclick = null);
        document.querySelectorAll('.decision-btn').forEach(btn => btn.onclick = null);
        showRetryButton();
        return true;
      }
      return false;
    }

    function showRetryButton() {
      const log = document.getElementById('log-container');
      const retryButton = document.createElement('button');
      retryButton.textContent = "Retry";
      retryButton.className = "new-game-btn";
      retryButton.onclick = startNewGame;
      log.innerHTML += `<div>ğŸ’¥ Game Over: You've gone bankrupt!</div>`;
      log.appendChild(retryButton);
      log.scrollTop = log.scrollHeight;
    }

    // Global startNewGame so itâ€™s accessible by retry buttons
    function startNewGame() {
      initializeGameState();
      startNewDay();
      updateMarketplaces();
      const retryBtn = document.querySelector('.new-game-btn');
      if (retryBtn) { retryBtn.remove(); }
    }

    function buyEquipment(name, cost, quality, maintenance) {
      if (gameState.cash < cost) {
        addMessage(`âŒ Not enough cash to buy ${name}`);
        return;
      }
      gameState.cash -= cost;
      if (checkBankruptcy()) return;
      gameState.equipment.push({ name, quality, maintenance });
      adjustArtistHappiness(quality / 2);
      adjustReputation(quality / 3);
      addMessage(`ğŸ›ï¸ Purchased ${name} for E${cost.toLocaleString()}`);
      updateGameDisplay();
    }

    function bookTraining(name, cost, skillBoost, duration) {
      if (gameState.cash < cost) {
        addMessage(`âŒ Not enough cash for ${name}`);
        return;
      }
      gameState.cash -= cost;
      if (checkBankruptcy()) return;
      adjustArtistPopularity(skillBoost);
      adjustStaffMorale(skillBoost / 2);
      addMessage(`ğŸ“š Booked ${name} for E${cost.toLocaleString()}`);
      updateGameDisplay();
    }

    function launchCampaign(name, cost, exposure, duration) {
      if (gameState.cash < cost) {
        addMessage(`âŒ Not enough cash for ${name}`);
        return;
      }
      gameState.cash -= cost;
      if (checkBankruptcy()) return;
      adjustArtistPopularity(exposure);
      adjustReputation(exposure / 2);
      addMessage(`ğŸ“£ Launched ${name} for E${cost.toLocaleString()}`);
      updateGameDisplay();
    }

    function bookShow(name, cost, popularity, duration) {
      if (gameState.cash < cost) {
        addMessage(`âŒ Not enough cash to book ${name}`);
        return;
      }
      gameState.cash -= cost;
      if (checkBankruptcy()) return;
      adjustArtistPopularity(popularity);
      adjustReputation(popularity / 2);
      addMessage(`ğŸ­ Booked ${name} for E${cost.toLocaleString()}`);
      updateGameDisplay();
    }

    function acceptDeal(name, cost, revenue, duration) {
      if (gameState.cash < cost) {
        addMessage(`âŒ Not enough cash for ${name}`);
        return;
      }
      gameState.cash -= cost;
      if (checkBankruptcy()) return;
      gameState.activeDeals.push({ name, revenue, daysLeft: duration });
      adjustReputation(10);
      addMessage(`ğŸ“ Accepted ${name} for E${cost.toLocaleString()}`);
      updateGameDisplay();
    }

    function signArtist(name, genre, cost, popularity, contractCost) {
      if (gameState.cash < cost) {
        addMessage(`âŒ Not enough cash to sign ${name}`);
        return;
      }
      gameState.cash -= cost;
      gameState.artists.push({
        name,
        genre,
        popularity,
        happiness: 100,
        contractDays: 30
      });
      adjustReputation(15);
      addMessage(`ğŸ¤ Signed ${name} for E${cost.toLocaleString()}`);
      updateGameDisplay();
    }

    // New function to display action summary with rating, cash flow, and reputation effect.
    function showActionSummary(cashEffect, repChange) {
      let rating;
      if (cashEffect > 0 && repChange > 0) {
          rating = "Excellent decision!";
      } else if (cashEffect > 0 || repChange > 0) {
          rating = "Good decision!";
      } else if (cashEffect < 0 && repChange < 0) {
          rating = "Poor decision!";
      } else {
          rating = "Mixed results.";
      }
      let summary = `Action Summary: ${rating} Cash ${cashEffect >= 0 ? "inflow" : "outflow"}: E${Math.abs(cashEffect).toLocaleString()}, Reputation change: ${repChange >= 0 ? "+" : ""}${repChange}.`;
      addMessage(summary);
    }

    function startNewDay() {
      if (gameState.day > 50) {
        endGame();
        return;
      }
      
      let dailyRevenue = 0;
      let maintenanceCost = 0;
      
      gameState.equipment.forEach(item => {
        maintenanceCost += item.maintenance;
      });
      
      gameState.activeDeals = gameState.activeDeals.filter(deal => {
        deal.daysLeft--;
        if (deal.daysLeft > 0) {
          dailyRevenue += deal.revenue;
          return true;
        }
        addMessage(`ğŸ“ Deal expired: ${deal.name} has been removed`);
        return false;
      });
      
      gameState.artists.forEach(artist => {
        const artistRevenue = Math.floor(artist.popularity * 1000 * (1 + gameState.reputation / 100));
        dailyRevenue += artistRevenue;
        addMessage(`ğŸ’« ${artist.name} generated E${artistRevenue.toLocaleString()} today`);
      });
      
      if (maintenanceCost > 0) {
        gameState.cash -= maintenanceCost;
        addMessage(`ğŸ”§ Daily equipment maintenance cost: E${maintenanceCost.toLocaleString()}`);
      }
      
      if (dailyRevenue > 0) {
        gameState.cash += dailyRevenue;
        addMessage(`ğŸ’° Total daily revenue: E${dailyRevenue.toLocaleString()}`);
        adjustReputation(Math.floor(dailyRevenue / 10000));
      }
      
      gameState.artists = gameState.artists.filter(artist => {
        artist.contractDays--;
        const totalEquipmentQuality = gameState.equipment.reduce((sum, item) => sum + item.quality, 0);
        const happinessBoost = Math.floor(totalEquipmentQuality / 10);
        artist.happiness = Math.min(100, artist.happiness + happinessBoost);
        
        if (artist.contractDays <= 5 && artist.contractDays > 0) {
          const renewalCost = Math.floor(artist.popularity * 1000);
          addMessage(`âš ï¸ ${artist.name}'s contract expires in ${artist.contractDays} day${artist.contractDays > 1 ? 's' : ''}!`);
          addMessage(`ğŸ’¼ Renewal cost will be E${renewalCost.toLocaleString()}`);
          return true;
        } else if (artist.contractDays === 0) {
          const renewalCost = Math.floor(artist.popularity * 1000);
          if (gameState.cash >= renewalCost && artist.happiness >= 70) {
            gameState.cash -= renewalCost;
            artist.contractDays = 30;
            addMessage(`âœ¨ ${artist.name} renewed their contract for E${renewalCost.toLocaleString()}!`);
            adjustReputation(10);
            return true;
          } else {
            addMessage(`ğŸ¤ Contract expired: ${artist.name} has left the label`);
            adjustReputation(-5);
            return false;
          }
        }
        return true;
      });
      
      gameState.day++;
      // Reassign a new scenario so that the prompt shows up
      gameState.scenarios = [...scenarios].sort(() => Math.random() - 0.5).slice(0, 1);
      showNextScenario();
      updateGameDisplay();
      updateMarketplaces();
      
      if (gameState.artists.length === 0) {
        addMessage("âš ï¸ Warning: You have no artists! Sign new talent quickly!");
      }
      checkBankruptcy();
    }

    // Now show the scenario prompt in the dedicated container.
    function showNextScenario() {
      const scenario = gameState.scenarios[0];
      if (!scenario) return;
      const html = `
        <div class="scenario-box">
          <h3>${scenario.question}</h3>
          ${scenario.options.map((opt, index) => `
            <button class="decision-btn" onclick="handleDecision(${index})">
              ${opt.text}
            </button>
          `).join('')}
        </div>
      `;
      document.getElementById('scenario-container').innerHTML = html;
    }

    function handleDecision(optionIndex) {
      const scenario = gameState.scenarios[0];
      if (!scenario) return;
      
      const option = scenario.options[optionIndex];
      let repBefore = gameState.reputation;
      const cashEffect = option.effect();
      let repAfter = gameState.reputation;
      let repChange = repAfter - repBefore;
      
      gameState.cash += cashEffect;
      if (checkBankruptcy()) return;
      
      addMessage(`Decision made: ${option.text}`);
      if (cashEffect > 0) {
        addMessage(`ğŸ’° Gained E${Math.abs(cashEffect).toLocaleString()}`);
      } else if (cashEffect < 0) {
        addMessage(`ğŸ’¸ Spent E${Math.abs(cashEffect).toLocaleString()}`);
      }
      
      // Display the action summary
      showActionSummary(cashEffect, repChange);
      
      if (gameState.day > 50) {
        endGame();
      } else {
        startNewDay();
      }
      updateGameDisplay();
    }

    function endGame() {
      addMessage("ğŸ Game Over: You've reached the end of 50 days!");
      addMessage(`Final Cash: E${gameState.cash.toLocaleString()}`);
      addMessage(`Final Reputation: ${gameState.reputation}`);
      document.querySelectorAll('.market-item').forEach(item => item.onclick = null);
      document.querySelectorAll('.decision-btn').forEach(btn => btn.onclick = null);
      showRetryButton();
    }

    function updateShowsMarket() {
      document.getElementById('shows-market').innerHTML = marketData.shows.map(show => `
        <div class="market-item" onclick="bookShow('${show.name}', ${show.cost}, ${show.popularity}, ${show.duration})">
          <strong>${show.name}</strong><br>
          ğŸ’° Cost: E${show.cost.toLocaleString()}<br>
          ğŸ“ˆ Popularity Boost: +${show.popularity}<br>
          â±ï¸ Duration: ${show.duration} day${show.duration > 1 ? 's' : ''}
        </div>
      `).join('');
    }

    function updateDealsMarket() {
      document.getElementById('deals-market').innerHTML = marketData.deals.map(deal => `
        <div class="market-item" onclick="acceptDeal('${deal.name}', ${deal.cost}, ${deal.revenue}, ${deal.duration})">
          <strong>${deal.name}</strong><br>
          ğŸ’° Initial Cost: E${deal.cost.toLocaleString()}<br>
          ğŸ’µ Daily Revenue: E${deal.revenue.toLocaleString()}<br>
          â±ï¸ Duration: ${deal.duration} days
        </div>
      `).join('');
    }

    function updateArtistsMarket() {
      document.getElementById('artists-market').innerHTML = marketData.artists.map(artist => `
        <div class="market-item" onclick="signArtist('${artist.name}', '${artist.genre}', ${artist.cost}, ${artist.popularity}, ${artist.contractCost})">
          <strong>${artist.name}</strong><br>
          ğŸµ Genre: ${artist.genre}<br>
          ğŸ’° Signing Cost: E${artist.cost.toLocaleString()}<br>
          ğŸ“ˆ Popularity: ${artist.popularity}<br>
          ğŸ“… Contract: 30 days
        </div>
      `).join('');
    }

    document.addEventListener('DOMContentLoaded', function() {
      initializeGameState();
      startNewDay();
      updateMarketplaces();
    });
  </script>
</body>
</html>
